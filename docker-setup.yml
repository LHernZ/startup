- hosts: localhost
  become: true
  tasks:
    - name: Install dependencies
      apt:
       name: "{{ item }}"
       state: present
       update_cache: yes
      loop:
       - apt-transport-https
       - ca-certificates
       - curl
       - gnupg-agent
       - software-properties-common
    - name: Add GPG key
      apt_key:
       url: https://download.docker.com/linux/ubuntu/gpg
       state: present
    - name: Add docker repository
      apt_repository:
       repo: deb https://download.docker.com/linux/ubuntu focal stable
       state: present
    - name: Install docker
      apt:
       name: "{{ item }}"
       state: latest
       update_cache: yes
      loop:
       - docker-ce
       - docker-ce-cli
       - containerd.io
    - name: Start docker service
      service:
       name: docker
       state: started
       enabled: yes
    - name: Install docker-compose
      get_url:
       url: https://github.com/docker/compose/releases/download/1.24.0/docker-compose-{{ ansible_system }}-{{ ansible_userspace_architecture }}
       dest: /usr/local/bin/docker-compose
       mode: 'a+x'
    - name: Create docker group
      group:
       name: docker
       state: present
       system: yes
    - name: Add user to docker group
      user:
       name: lhernz
       group: docker

  handlers:
   - name: Restart docker
     service:
      name: docker
      state: restarted
